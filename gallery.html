<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moges Store - Gallery</title>
  <style>
    :root {
      --pink: #e91e63;
      --gold: #bfa14a;
      --dark: #1a1a1a;
      --white: #ffffff;
      --transparent: rgba(255, 255, 255, 0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: linear-gradient(135deg, var(--dark) 60%, var(--pink) 100%);
      color: var(--white);
      font-family: "Poppins", sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      backdrop-filter: blur(10px);
      background: var(--transparent);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    header h1 {
      font-size: 1.5rem;
      color: var(--gold);
    }
    .controls {
      display: flex;
      gap: 10px;
    }
    button {
      background: var(--pink);
      color: var(--white);
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.3s;
    }
    button:hover {
      background: var(--gold);
      color: var(--dark);
    }
    main {
      flex: 1;
      padding: 20px;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }
    .tile {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .tile img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    .delete-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(0,0,0,0.5);
      border: none;
      color: var(--white);
      border-radius: 50%;
      width: 26px;
      height: 26px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .delete-btn:hover {
      background: var(--pink);
    }
    footer {
      text-align: center;
      padding: 12px;
      background: var(--transparent);
      color: var(--gold);
      border-top: 1px solid rgba(255,255,255,0.2);
    }
  </style>
</head>
<body>
  <header>
    <h1>üì∏ Moges Gallery</h1>
    <div class="controls">
      <input type="file" id="fileInput" accept="image/*" multiple style="display:none" />
      <button onclick="document.getElementById('fileInput').click()">‚ûï Ongeza Picha</button>
      <button onclick="clearAll()">üóëÔ∏è Futa Zote</button>
    </div>
  </header>

  <main>
    <div class="gallery" id="gallery"></div>
  </main>

  <footer>¬© <span id="year"></span> Moges Store | Gallery</footer>

  <script>
    // ========== IndexedDB Setup ==========
    const dbName = "MogesGalleryDB";
    let db;

    function initDB() {
      const request = indexedDB.open(dbName, 1);
      request.onupgradeneeded = e => {
        db = e.target.result;
        db.createObjectStore("images", { keyPath: "id", autoIncrement: true });
      };
      request.onsuccess = e => {
        db = e.target.result;
        loadImages();
      };
      request.onerror = e => console.error("DB Error:", e);
    }

    // ========== Load & Render Images ==========
    function loadImages() {
      const tx = db.transaction("images", "readonly");
      const store = tx.objectStore("images");
      const req = store.getAll();
      req.onsuccess = () => renderGallery(req.result);
    }

    function renderGallery(images) {
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";
      images.forEach(img => {
        const div = document.createElement("div");
        div.className = "tile";
        div.innerHTML = `
          <img src="${img.data}" alt="Image">
          <button class="delete-btn" onclick="deleteImage(${img.id})">√ó</button>
        `;
        gallery.appendChild(div);
      });
    }

    // ========== Add Images ==========
    document.getElementById("fileInput").addEventListener("change", e => {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          const tx = db.transaction("images", "readwrite");
          const store = tx.objectStore("images");
          store.add({ data: reader.result });
          tx.oncomplete = loadImages;
        };
        reader.readAsDataURL(file);
      });
    });

    // ========== Delete Single Image ==========
    function deleteImage(id) {
      const tx = db.transaction("images", "readwrite");
      const store = tx.objectStore("images");
      store.delete(id);
      tx.oncomplete = loadImages;
    }

    // ========== Clear All ==========
    function clearAll() {
      if (confirm("Una uhakika unataka kufuta picha zote?")) {
        const tx = db.transaction("images", "readwrite");
        const store = tx.objectStore("images");
        store.clear();
        tx.oncomplete = loadImages;
      }
    }

    // ========== Misc ==========
    document.getElementById("year").textContent = new Date().getFullYear();
    window.onload = initDB;
  </script>
</body>
</html>
